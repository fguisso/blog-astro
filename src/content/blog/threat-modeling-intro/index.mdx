---
title: "Threat Modeling Express: guia pr√°tico"
lang: 'pt'
canonicalSlug: 'threat-modeling-intro'
description: "Como engajar o time, mapear ativos cr√≠ticos e aplicar controles r√°pidos com Threat Modeling Express."
pubDate: 2024-09-28T07:29:47-03:00
showTableOfContents: false
showDate: true
tags: ["Threat Modeling", "Seguran√ßa", "DevSecOps"]
---
import Callout from '../../../components/Callout.astro';

## Introdu√ß√£o

Threat Modeling, ou modelagem de amea√ßas, √© uma pr√°tica essencial para equipes que buscam identificar e mitigar amea√ßas e vulnerabilidades em seus sistemas. Em um cen√°rio de seguran√ßa em constante evolu√ß√£o, o **Threat Modeling Express** √© uma abordagem que permite integrar seguran√ßa ao ciclo de desenvolvimento √°gil de forma cont√≠nua e colaborativa. Essa pr√°tica permite uma vis√£o do todo, facilitando tanto a detec√ß√£o de problemas como o engajamento do time em pr√°ticas de seguran√ßa.

Neste artigo, veremos a aplica√ß√£o pr√°tica do Threat Modeling Express, explorando desde a concep√ß√£o at√© os controles implementados. Adicionaremos os aprendizados do dia a dia para que o processo seja completo e realista.

### Palestra e video

Caso queira acompanhar este artigo como uma palestra, voc√™ pode acessar meus slides interativos <a href="https://guisso.dev/talks/threat-modeling" target="_blank">aqui</a> e o video desta palestra no Cap√≠tulo OWASP Bras√≠lia <a href="https://www.youtube.com/watch?v=3TVmFqaAA1o" target="_blank">aqui</a>.

<Callout variant="danger" title="Mini game" icon="üî•">
	Experimente o <a href="https://guisso.dev/tme-game/" target="_blank">Threat Modeling Express mini game</a> para validar o que aprendeu.
</Callout>

## O que √© Threat Modeling?

**Threat Modeling** √© o processo de identificar amea√ßas, vulnerabilidades e contramedidas em sistemas, com o objetivo de minimizar os riscos e fortalecer a seguran√ßa. Ele exige que pensemos como atacantes para antecipar poss√≠veis falhas de seguran√ßa. Ao contr√°rio de ferramentas de seguran√ßa que geralmente detectam apenas vulnerabilidades t√©cnicas, o Threat Modeling permite enxergar o impacto direto de amea√ßas no neg√≥cio.

## Origem e Evolu√ß√£o do Threat Modeling

A modelagem de amea√ßas evoluiu ao longo das d√©cadas desde os anos 60, com marcos importantes que moldaram a pr√°tica atual:

- **1960s**: In√≠cio dos primeiros ataques contra sistemas compartilhados com acesso multiusu√°rio.
- **1988**: Robert Barnard desenvolve o primeiro perfil de atacantes para sistemas de TI.
- **1994**: Edward Amoroso introduz o conceito de "threat trees", estruturando graficamente como amea√ßas podem ser exploradas.
- **1998**: Bruce Schneier populariza "attack trees", permitindo uma an√°lise mais sistem√°tica de riscos cibern√©ticos.
- **1999**: Microsoft cria o **STRIDE**, uma metodologia amplamente usada para identificar amea√ßas espec√≠ficas em sistemas.
- **2020**: Lan√ßamento do **Threat Modeling Manifesto**, enfatizando princ√≠pios centrais para a pr√°tica de Threat Modeling.
- **2024**: Publica√ß√£o do documento de **Capacidades de Threat Modeling**, oferecendo diretrizes para maximizar a efic√°cia da modelagem de amea√ßas.

Esses avan√ßos mostram como a pr√°tica se desenvolveu para se tornar um componente essencial na seguran√ßa moderna, integrando-se cada vez mais aos processos de desenvolvimento de software.

## Por que Threat Modeling √© Importante?

Diferente de outras pr√°ticas de seguran√ßa que focam em vulnerabilidades, o Threat Modeling permite entender o impacto direto das amea√ßas sobre o neg√≥cio. Em vez de apresentar uma lista t√©cnica de falhas, trazemos uma vis√£o clara e compreens√≠vel para gestores, explicando o impacto de cada amea√ßa e justificando a import√¢ncia de mitig√°-las. Isso facilita a comunica√ß√£o entre equipes t√©cnicas e de neg√≥cios, trazendo alinhamento e evitando retrabalhos em produ√ß√£o.

Por exemplo, √© mais f√°cil para um executivo entender que h√° um risco de perda financeira devido √† manipula√ß√£o de dados (amea√ßa) do que explicar que uma vulnerabilidade t√©cnica, como **Insecure Deserialization**, pode levar a um **RCE** (Remote Code Execution).

## Crescimento do Threat Modeling no Mercado

O uso de Threat Modeling tem crescido exponencialmente √† medida que empresas buscam maneiras de se proteger proativamente contra amea√ßas cibern√©ticas. Em eventos como a [ThreatModCon](https://www.threatmodcon.com/), l√≠deres da ind√∫stria compartilham suas experi√™ncias e abordagens inovadoras, mostrando como a pr√°tica est√° evoluindo para atender √†s necessidades de um mercado em constante mudan√ßa.

## Abordagens Tradicionais e Ferramentas de Threat Modeling

Existem v√°rias metodologias tradicionais para Threat Modeling, cada uma com suas peculiaridades:

- **[STRIDE](https://learn.microsoft.com/en-us/previous-versions/commerce-server/ee823878(v=cs.20))**: Focado em amea√ßas espec√≠ficas, como spoofing e eleva√ß√£o de privil√©gio.
- **[PASTA](https://www.wiley.com/en-us/Risk+Centric+Threat+Modeling%3A+Process+for+Attack+Simulation+and+Threat+Analysis-p-9780470500965)**: Um modelo em sete etapas que alinha objetivos de neg√≥cios com requisitos t√©cnicos.
- **[Trike](https://www.iriusrisk.com/resources-blog/trike-threat-modeling-methodologies)**: Enfatiza a auditoria e o gerenciamento de riscos.
- **[VAST](https://www.threatmodeler.com/threat-modeling-methodologies-vast/)**: Integrado ao DevOps, usa diagramas de fluxo para modelar amea√ßas de forma √°gil.
- **Hybrid**: Combina elementos de diferentes metodologias para cen√°rios complexos.

# Threat Modeling Express

A abordagem √°gil chamada **Threat Modeling Express** simplifica o processo tradicional, focando na colabora√ß√£o e itera√ß√µes r√°pidas. A metodologia √© desenhada para se integrar ao DevSecOps, permitindo que equipes desenvolvam modelos de amea√ßa em ciclos curtos e continuem aprimorando-os √† medida que o desenvolvimento avan√ßa.

## Processo do Threat Modeling Express

### 1. Prepara√ß√£o e Engajamento da Equipe

O engajamento da equipe √© o ponto de partida e deve come√ßar antes da modelagem de amea√ßas em si. Garantir que os desenvolvedores estejam confort√°veis com as pr√°ticas de seguran√ßa e integrados ao time √© essencial. A pr√°tica de DevSecOps preza pelo envolvimento de todos os membros do time, incluindo engenheiros, designers e PMs. √â importante que todos compreendam a import√¢ncia de cada etapa do processo, o que facilita a implementa√ß√£o dos controles mais tarde.

> *Meu papel como appsec √© fazer os devs "brigarem" por seguran√ßa, assim como hoje eles "birgam" pelo vscode ser melhor que o vim ou emacs.*<br />
> ‚Äî Fernando Guisso

### 2. Cria√ß√£o do Data Flow

A cria√ß√£o do **data flow** √© fundamental para mapear onde os dados transitam no sistema e onde podem ser comprometidos. O processo envolve a equipe de desenvolvimento, pois s√£o eles que conhecem melhor o sistema. Incentive o time a direcionar a cria√ß√£o do dataflow, identificando usu√°rios, processos e bancos de dados.

Ferramentas familiares ao time, como Excalidraw, draw.io ou at√© mesmo diagramas MermaidJS, podem ser usadas para garantir que todos estejam confort√°veis com o processo. O importante √© que a equipe esteja √† vontade com a ferramenta escolhida, para que o foco esteja na an√°lise das amea√ßas, e n√£o na adapta√ß√£o √† tecnologia usada para o dataflow.

Durante essa etapa, √© importante focar nos fluxos principais e simplificar. Podemos detalhar cada endpoint, mas, para uma abordagem mais √°gil, o objetivo √© capturar os fluxos mais cr√≠ticos. Lembre-se de que o escopo deve se concentrar no que o time pode atuar, evitando mapear processos que est√£o fora do controle direto da equipe.

![Fluxo de dados do Threat Modeling Express](./threat-modeling-sample.svg)

### 3. Identifica√ß√£o de Ativos

Ap√≥s o mapeamento do fluxo de dados, √© importante identificar quais ativos s√£o cr√≠ticos e necessitam de prote√ß√£o extra. A equipe deve listar todos os componentes ou dados essenciais que podem gerar impactos relevantes caso sejam comprometidos. No entanto, √© preciso restringir a lista apenas aos elementos mais cr√≠ticos, aqueles que realmente exigem controles de seguran√ßa espec√≠ficos.

![Mapa de ativos cr√≠ticos](./threat-modeling-assets.svg)

<span class="pill pill-orange">A1</span> **Token de sess√£o do usu√°rio**:
- Ao analisar a aplica√ß√£o, vimos que o Token de sess√£o √© o principal mecanismo de autentica√ß√£o e autoriza√ß√£o para o usu√°rio. Se um atacante obtiver esse token, ele pode realizar a√ß√µes em nome do usu√°rio sem qualquer restri√ß√£o. Isso √© cr√≠tico, pois envolve diretamente a identidade do usu√°rio e pode resultar em acesso indevido a informa√ß√µes sens√≠veis.
- Aqui voc√™ pode notar que o A1 est√£o em mais de um lugar, no caso s√≥ anotamos onde os dados est√£o em repouso, mas a depender do seu tempo para montar o Dataflow, voc√™ pode anotar todos os pontos por onde um Ativo esta em repouso ou em tr√¢nsito.

<span class="pill pill-orange">A2</span> **Dados pessoais**:
- Identificamos que a aplica√ß√£o armazena dados pessoais, como nome, CPF, e possivelmente outras informa√ß√µes sens√≠veis dos usu√°rios. Esses dados n√£o apenas precisam estar protegidos por conformidade com leis de privacidade, mas tamb√©m s√£o um alvo comum de ataques. Garantir a prote√ß√£o desses dados √© fundamental para evitar vazamentos que poderiam comprometer a privacidade e a confian√ßa dos usu√°rios.

<span class="pill pill-orange">A3</span> **Credenciais do banco de dados**:
- As credenciais do banco de dados s√£o essenciais para a aplica√ß√£o se conectar ao banco e realizar opera√ß√µes. Se um atacante conseguir acesso a essas credenciais, ele pode obter acesso direto ao banco de dados, com potencial para ler, alterar ou at√© mesmo excluir dados. Esse √© um ativo de alta prioridade, pois a exposi√ß√£o dessas credenciais comprometeria totalmente a integridade e confidencialidade dos dados armazenados.

### 4. Listagem de Amea√ßas

Na listagem de amea√ßas, o objetivo √© se colocar na posi√ß√£o dos atacantes e pensar como eles comprometeriam o sistema. A equipe deve usar o **data flow** criado para identificar os pontos onde os ativos podem ser atacados. Incentive o time a "vestir o chap√©u" de diferentes atores de amea√ßas, abrindo a mente para novas possibilidades.

#### Atores de Amea√ßa

A modelagem de amea√ßas deve considerar uma variedade de atores, incluindo:

- **Cibercriminosos**: Motivados por ganhos financeiros, frequentemente utilizam ransomware e phishing.
- **Atores patrocinados por estados**: Focados em espionagem e sabotagem, visando infraestruturas cr√≠ticas.
- **Hacktivistas**: Buscam promover causas sociais ou pol√≠ticas.
- **Curiosos**: Atacam por divers√£o ou aprendizado, mas podem causar danos.
- **Insiders**: Atores internos, intencionais ou acidentais, que t√™m acesso privilegiado ao sistema.
- **Ciberterroristas**: Movidos por ideologias pol√≠ticas ou religiosas, buscando causar caos.

Al√©m desses, na nossa empresa discutimos novas possibilidades, como **f√£s de reality shows(Big Brother Brasil)** que organizam mutir√µes de votos ou campanhas de difama√ß√£o online s√£o uma tipo de ator de amea√ßa que pode trazer muito impacto para nosso produto. Hoje temos mais de [3M votos por minuto](https://www.hcaptcha.com/post/globo-counts-nearly-3-million-votes-per-minute-with-hcaptcha-enterprise) que precisam sem bem controlados, pois este programa √© um dos grandes produtos da empresa. Para entender melhor sobre como pensar novos atores, confira esta palestra da [OWASP Global AppSec 2023](https://owasp2023globalappsecwashin.sched.com/event/1M6Qh/the-threat-actors-we-forgot-to-model-profiling-socially-motivated-cyber-criminals).

![Atores de amea√ßa conectados a impactos](./threat-modeling-threats.svg)

<span class="pill pill-red">T1</span> **Intercepta√ß√£o de Dados Sens√≠veis**:

- Esta amea√ßa foi identificada ao analisarmos o fluxo de dados entre o cliente e o servidor. Quando informa√ß√µes, como credenciais e dados pessoais, s√£o transmitidas, existe o risco de intercepta√ß√£o, principalmente se a comunica√ß√£o n√£o estiver criptografada. A intercepta√ß√£o pode permitir que um atacante obtenha informa√ß√µes confidenciais em tr√¢nsito, comprometendo a privacidade e a integridade dos dados dos usu√°rios.

<span class="pill pill-red">T2</span> **Exposi√ß√£o de Token de Sess√£o**:

- O token de sess√£o √© essencial para autentica√ß√£o, ent√£o qualquer falha que permita seu acesso n√£o autorizado pode resultar em sequestro de sess√£o. Se o token for exposto, um invasor pode realizar a√ß√µes no sistema em nome do usu√°rio. Isso foi identificado ao pensarmos nas possibilidades de armazenamento inseguro ou na transmiss√£o inadequada do token em canais de comunica√ß√£o vulner√°veis.

<span class="pill pill-red">T3</span> **Indisponibilidade de Servi√ßo**:

- A disponibilidade √© um pilar importante de seguran√ßa. Esta amea√ßa foi considerada ao pensar em ataques de nega√ß√£o de servi√ßo (DoS) ou sobrecarga de recursos que podem tornar o sistema inacess√≠vel aos usu√°rios. A indisponibilidade, seja por ataque intencional ou falha t√©cnica, impacta diretamente a experi√™ncia do usu√°rio e a confiabilidade do sistema.

<span class="pill pill-red">T4</span> **Exposi√ß√£o de Credenciais**:

- As credenciais de acesso ao banco de dados e a outros servi√ßos cr√≠ticos s√£o altamente sens√≠veis. Durante a an√°lise, verificamos que uma m√° configura√ß√£o ou falta de prote√ß√£o adequada dessas credenciais poderia exp√¥-las, permitindo que um atacante acesse diretamente os dados. Essa amea√ßa visa comprometer diretamente a seguran√ßa do sistema, facilitando outros ataques.

<span class="pill pill-red">T5</span> **Acesso N√£o Autorizado a Informa√ß√µes Pessoais**:

- Essa amea√ßa surgiu da an√°lise de quem pode acessar informa√ß√µes pessoais sem permiss√£o. A exposi√ß√£o ou acesso n√£o autorizado a dados pessoais pode ocorrer por falhas de controle de acesso ou vulnerabilidades que permitam a explora√ß√£o direta do sistema. Isso representa uma viola√ß√£o de privacidade e poderia levar a consequ√™ncias legais e perda de confian√ßa dos usu√°rios.

### 5. Defini√ß√£o de Controles

Com as amea√ßas listadas, o pr√≥ximo passo √© definir os controles espec√≠ficos que mitigar√£o os riscos. Esses controles podem ser t√©cnicos ou processuais e devem ser documentados, mesmo se j√° estiverem implementados. Isso garante uma vis√£o ampla dos mecanismos de defesa e permite acompanhar a validade e efic√°cia dos controles ao longo do tempo.

O time deve criar tarefas claras para implementa√ß√£o e acompanhamento desses controles ao longo do ciclo de vida do produto. Isso inclui, por exemplo, validar se controles como autentica√ß√£o multifator ou criptografia continuam ativos e eficazes ap√≥s atualiza√ß√µes no sistema.

![Controles priorizados e evid√™ncias](./threat-modeling-controls.svg)

<span class="pill pill-blue">C1</span> **TLS Pinning**:

- Para evitar ataques man-in-the-middle (MitM), onde um invasor pode interceptar ou modificar dados em tr√¢nsito, implementamos TLS Pinning. Este controle garante que a aplica√ß√£o apenas aceite certificados espec√≠ficos e v√°lidos, protegendo a autenticidade da conex√£o com o servidor.

<span class="pill pill-blue">C2</span> **Criptografia de Dados Sens√≠veis em Tr√¢nsito**:

- Dados sens√≠veis, como informa√ß√µes pessoais ou tokens de sess√£o, est√£o em risco de intercepta√ß√£o. A criptografia dos dados em tr√¢nsito garante que qualquer dado capturado em uma intercepta√ß√£o seja ileg√≠vel e, portanto, inutiliz√°vel para o atacante.

<span class="pill pill-blue">C3</span> **Armazenamento Seguro de Tokens**:

- Para proteger tokens de sess√£o, √© essencial evitar o armazenamento em √°reas vulner√°veis. Em dispositivos m√≥veis, utilizamos o Keychain (iOS) e o Keystore (Android), que fornecem √°reas seguras e criptografadas, dificultando o acesso n√£o autorizado ao token.

<span class="pill pill-blue">C4</span> **Rate Limiting e Controle de Solicita√ß√µes**:

- Ataques de nega√ß√£o de servi√ßo (DoS) e sobrecarga de recursos s√£o mitigados ao limitar a quantidade de solicita√ß√µes permitidas por IP ou origem. Esse controle ajuda a manter a disponibilidade do sistema e a detectar acessos an√¥malos.

<span class="pill pill-blue">C5</span> **Armazenamento de Credenciais em Gerenciamento de Segredos**:

- As credenciais do banco de dados s√£o alvos de alta prioridade para invasores. Usar um sistema de gerenciamento de segredos, como AWS Secrets Manager ou HashiCorp Vault, permite o armazenamento criptografado e seguro, protegendo as credenciais e facilitando a rota√ß√£o e monitoramento de acesso.

<span class="pill pill-blue">C6</span> **Controles de Acesso Granulares**:

- Para reduzir o risco de acesso n√£o autorizado, implementamos controles de acesso com base no princ√≠pio do menor privil√©gio, garantindo que cada usu√°rio ou processo tenha acesso apenas aos dados e opera√ß√µes estritamente necess√°rios. Isso limita o impacto em caso de comprometimento de contas ou fun√ß√µes.

### Resultado final

Em conclus√£o, este exemplo ilustra como o processo de Threat Modeling vai al√©m de simplesmente mapear o fluxo de dados (dataflow). Embora o dataflow seja crucial para entendermos as intera√ß√µes e pontos de entrada do sistema, o verdadeiro valor para a maturidade de seguran√ßa do produto est√° nas anota√ß√µes detalhadas das amea√ßas e controles identificados.

As amea√ßas documentadas servem como uma base para antecipar riscos que podem surgir ao longo do desenvolvimento, enquanto os controles fornecem a linha de defesa necess√°ria para mitigar esses riscos. Manter essas anota√ß√µes atualizadas e revis√°-las periodicamente garante que, √† medida que o sistema evolui, a seguran√ßa continue a ser aprimorada, ajudando a proteger o produto contra ataques e a fortalecer a confian√ßa dos usu√°rios.

## Ferramentas e T√©cnicas de Apoio

Para facilitar o processo de Threat Modeling Express, √© poss√≠vel usar ferramentas como Excalidraw para visualiza√ß√£o r√°pida de fluxos de dados, Jira e Trello para gest√£o de tarefas, e Microsoft Threat Modeling Tool e OWASP Threat Dragon para modelagem de amea√ßas. A escolha da ferramenta deve priorizar a familiaridade da equipe, para que o tempo seja dedicado ao processo de seguran√ßa em si.

Antes de iniciar o processo de modelagem, √© essencial escolher uma ferramenta para desenhar o **data flow**. Algumas op√ß√µes populares incluem:

- Dataflow: Visualize fluxos de dados e identifique amea√ßas.
  - **[Excalidraw](https://excalidraw.com/)**
  - **[Draw.io](htpps://draw.io)**
  - **[Miro](https://miro.com/)**
  - **[MermaidJS](http://mermaid.js.org/)**
- Gerenciar Amea√ßas
  - **Integra√ß√£o com Jira e Trello**: Gerencie tarefas relacionadas ao Threat Modeling.
  - <span class="pill pill-blue">Interno</span> **Threat Modeling API**: Sistema interno do time de AppSec da Globo
  - <span class="pill pill-blue">Em constru√ß√£o</span> **[ThreatMax](https://github.com/fguisso/threatmax)**  

O importante √© que o time esteja confort√°vel com a ferramenta escolhida, pois o objetivo √© usar o tempo para modelar amea√ßas e n√£o para aprender a usar uma nova ferramenta. Se o time j√° tem conhecimento de uma dessas op√ß√µes, √© mais eficiente seguir com ela para garantir que todos estejam focados no objetivo principal.

## Desafios e Boas Pr√°ticas

A implementa√ß√£o de Threat Modeling Express pode enfrentar resist√™ncia devido √† necessidade de mudan√ßa cultural. Engajar o time e promover uma cultura de seguran√ßa s√£o essenciais para superar esse desafio. Para algumas empresas, programas de Security Champions, recompensas por participa√ß√£o e eventos regulares de seguran√ßa, como dojo e sess√µes de hands-on, ajudam a cultivar uma cultura de seguran√ßa.

## Medindo o Sucesso

Para monitorar o sucesso do Threat Modeling, √© importante acompanhar m√©tricas, como o n√∫mero de amea√ßas identificadas e mitigadas. Algumas empresas desenvolvem sistemas personalizados para registrar amea√ßas e controles, permitindo an√°lise cont√≠nua e ajuste de processos conforme necess√°rio.

## Casos de Uso: Itera√ß√µes Cont√≠nuas e Alinhamento Constante

Em equipes √°geis, onde as funcionalidades mudam a cada sprint, recomenda-se realizar uma an√°lise de Threat Modeling em incrementos pequenos, acompanhando cada nova funcionalidade. No entanto, o n√≠vel de maturidade da equipe pode influenciar a frequ√™ncia da modelagem.

## Conclus√£o

O **Threat Modeling Express** oferece uma maneira √°gil e eficiente de integrar a modelagem de amea√ßas ao ciclo de desenvolvimento, ajudando a mitigar riscos antes que eles se tornem problemas. Com a crescente complexidade das amea√ßas, √© essencial que as equipes de seguran√ßa e desenvolvimento trabalhem juntas para proteger seus sistemas de forma proativa.

Se voc√™ ainda n√£o implementou o Threat Modeling, agora √© a hora de come√ßar. Integre-o ao seu pipeline de desenvolvimento e mantenha sua organiza√ß√£o segura contra as amea√ßas de hoje e de amanh√£.

Lembre-se, seguran√ßa √© um processo cont√≠nuo e colaborativo, e quanto mais cedo ela for integrada no desenvolvimento, mais eficaz ser√° a prote√ß√£o de seus sistemas.
