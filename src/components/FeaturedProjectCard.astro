---
import type { FeaturedProject } from '../theme.config';
import { t } from '../i18n';
import { getRequestLocale, type LocaleCode } from '../i18n/config';

interface Props {
	project: FeaturedProject;
	locale?: LocaleCode;
}

const { project, locale: forcedLocale } = Astro.props as Props;
const locale = forcedLocale ?? getRequestLocale(Astro);
const projectLabel = t(locale, 'projects.cardLabel');
const projectCta = t(locale, 'projects.cardCta');
const slugify = (value: string) =>
	value
		.normalize('NFD')
		.replace(/[\u0300-\u036f]/g, '')
		.toLowerCase()
		.replace(/[^a-z0-9]+/g, '-')
		.replace(/^-+|-+$/g, '') || 'project';

const projectSlug = slugify(project.title);
const eventName = `click_project_${projectSlug}_${locale}`;
---

<li class="featured-project" style={`--project-image: url("${project.image}")`}>
	<a
		href={project.url}
		class="featured-project__link"
		target="_blank"
		rel="noopener noreferrer"
		data-tianji-event={eventName}
	>
		<div class="featured-project__content">
			<span class="featured-project__label">{projectLabel}</span>
			<h3 class="featured-project__name">{project.title}</h3>
			<p class="featured-project__description">{project.description}</p>
			<span class="featured-project__cta">{projectCta}</span>
		</div>
	</a>
</li>
